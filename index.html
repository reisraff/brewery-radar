<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hop Radar ‚Äì View & Compare Hops</title>
<!-- Chart.js via CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<style>
  :root{
    --bg:#0b1020;
    --card:#131a33;
    --muted:#a8b3cf;
    --text:#e8ecf8;
    --brand-left:#4c8df6;   /* azul (Esquerda) */
    --brand-right:#e65bb7;  /* magenta (Direita) */
    --ring:#2a335a;
  }
  *{box-sizing:border-box}
  body{
    margin:0; padding:24px;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    color:var(--text); background: radial-gradient(1200px 700px at 20% -10%, #1c2550 0%, var(--bg) 35%), var(--bg);
  }
  h1{font-size:clamp(20px,3vw,28px); margin:0 0 8px 0; letter-spacing:.2px}
  .sub{color:var(--muted); margin-bottom:22px}
  .container{
    display:grid; gap:18px;
    grid-template-columns: 320px 1fr 320px;
  }
  @media (max-width: 1200px){
    .container{grid-template-columns: 280px 1fr 280px; gap:12px}
  }
  @media (max-width: 980px){
    .container{
      grid-template-columns: 1fr;
      grid-template-rows: auto auto auto;
    }
    .left-panel { order: 1; }
    .chart-panel { order: 3; }
    .right-panel { order: 2; }
  }
  .panel{
    background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    border:1px solid #1f2647;
    border-radius:16px;
    padding:16px;
    box-shadow: 0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.05);
  }
  .panel h2{margin:2px 0 12px 0; font-size:16px; color:#ced7ff; font-weight:700}
  .row{display:flex; gap:10px; margin-bottom:10px}
  label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px}
  select, input[type="text"]{
    width:100%;
    background:#0f1530; color:var(--text);
    border:1px solid #27305a; border-radius:10px;
    padding:10px 12px; outline:none;
    font-size:14px; transition:border .2s, box-shadow .2s;
  }
  select:focus, input[type="text"]:focus{
    border-color:#5a6ee5; box-shadow:0 0 0 3px rgba(90,110,229,.25)
  }
  .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 10px; border-radius:999px; font-weight:600; font-size:12px; letter-spacing:.2px
  }
  .left-pill{background:rgba(76,141,246,.12); color:#cfe1ff; border:1px solid rgba(76,141,246,.35)}
  .right-pill{background:rgba(230,91,183,.12); color:#ffd1ef; border:1px solid rgba(230,91,183,.35)}
  .meta{
    display:grid; gap:8px; margin-top:6px
  }
  .meta .item{
    background:#0f1530; border:1px solid #27305a; border-radius:10px; padding:10px 12px;
  }
  .meta .item b{color:#cfd7ff; font-size:12px}
  .styles{display:flex; flex-wrap:wrap; gap:6px; margin-top:6px}
  .tag{
    background:#0a112b; color:#d7def9; border:1px solid #243062;
    font-size:12px; padding:6px 8px; border-radius:999px
  }
  .header{
    display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px
  }
  .legend{
    display:flex; gap:8px; align-items:center; flex-wrap:wrap
  }
  .legend .key{
    display:inline-flex; align-items:center; gap:6px; font-size:12px; color:var(--muted)
  }
  .dot{
    width:10px; height:10px; border-radius:50%
  }
  .hint{color:var(--muted); font-size:12px; margin-top:10px}
  canvas{width:100% !important; height:auto !important; max-height:70vh}
  .chart-container{position:relative; font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif}
  .footnote{margin-top:10px; font-size:12px; color:#9fb0ff}
  .search{margin-bottom:10px}
  .lang-selector{
    position:absolute; top:24px; right:24px;
    background:rgba(255,255,255,.04); border:1px solid #1f2647;
    border-radius:8px; padding:4px;
    display:flex; gap:2px;
  }
  .lang-btn{
    background:transparent; border:none; color:var(--muted);
    padding:6px 8px; border-radius:6px; cursor:pointer;
    font-size:11px; font-weight:600; text-transform:uppercase;
    transition:all .2s;
  }
  .lang-btn:hover{background:rgba(255,255,255,.08); color:var(--text)}
  .lang-btn.active{background:var(--brand-left); color:#fff}
  .flag{
    width:16px; height:12px; border-radius:2px; display:inline-block;
    margin-left:6px; vertical-align:middle; border:1px solid rgba(255,255,255,.15);
    background-size:cover; background-position:center;
  }
</style>
</head>
<body>
  <div class="lang-selector">
    <button class="lang-btn active" data-lang="pt">PT</button>
    <button class="lang-btn" data-lang="en">EN</button>
    <button class="lang-btn" data-lang="es">ES</button>
  </div>
  
  <h1 data-i18n="title">Radar de L√∫pulos ‚Äì Visualiza√ß√£o & Compara√ß√£o</h1>
  <div class="sub" data-i18n="subtitle">Selecione um l√∫pulo para o <b>lado esquerdo</b> (azul) e, opcionalmente, outro para o <b>lado direito</b> (magenta). Passe o mouse no gr√°fico para ver os valores.</div>
  <div class="sub" style="color: #f59e0b; margin-top: 8px;" data-i18n="warning">‚ö†Ô∏è Se algum l√∫pulo n√£o estiver inclu√≠do na lista, envie um email para: reisraff@gmail.com</div>

  <div class="container">
    <!-- Painel esquerdo -->
    <div class="panel left-panel">
      <h2 data-i18n="left_label">Lado Esquerdo (Azul)</h2>

      <div class="search">
        <label for="q" data-i18n="filter_label">Filtro r√°pido (por nome, pa√≠s ou estilo)</label>
        <input id="q" type="text" data-i18n-placeholder="filter_placeholder" placeholder="Ex.: IPA, Alemanha, Citra..." />
      </div>

      <div>
        <label for="leftSel" data-i18n="left_selector_label">Selecionar L√∫pulo</label>
        <select id="leftSel"></select>
      </div>

      <div class="meta">
        <div class="item">
          <span class="pill left-pill" data-i18n="left_pill">ESQUERDA</span>
          <div id="leftMeta"></div>
        </div>
      </div>

      <div class="hint" data-i18n="hint">Dica: use o filtro para reduzir a lista por pa√≠s (ex.: <i>US</i>, <i>DE</i>, <i>GB</i>) ou por um estilo (ex.: <i>NEIPA</i>, <i>K√∂lsch</i>).</div>
    </div>

    <!-- Painel do gr√°fico -->
    <div class="panel chart-panel">
      <div class="header">
        <h2 style="margin:0" data-i18n="chart_title">Gr√°fico em Teia</h2>
        <div class="legend">
          <span class="key"><span class="dot" style="background:var(--brand-left)"></span> <span data-i18n="legend_left">Esquerda</span></span>
          <span class="key"><span class="dot" style="background:var(--brand-right)"></span> <span data-i18n="legend_right">Direita</span></span>
          <span class="key" data-i18n="legend_scale">Escala 0‚Äì10</span>
        </div>
      </div>
      <canvas id="radar"></canvas>
      <div class="footnote" data-i18n="footnote">As pontas representam as caracter√≠sticas: Ch√°, C√≠trico, Verde, Caramelado, Amadeirado, Picante, Mentolado, Herbal, Vegetal, Floral, Fruta Verde, Fruta Vermelha, Fruta Amarela, Fruta Doce.</div>
    </div>

    <!-- Painel direito -->
    <div class="panel right-panel">
      <h2 data-i18n="right_label">Lado Direito (Magenta)</h2>

      <div class="search">
        <label for="q2" data-i18n="filter_label">Filtro r√°pido (por nome, pa√≠s ou estilo)</label>
        <input id="q2" type="text" data-i18n-placeholder="filter_placeholder" placeholder="Ex.: IPA, Alemanha, Citra..." />
      </div>

      <div>
        <label for="rightSel" data-i18n="right_selector_label">Selecionar L√∫pulo</label>
        <select id="rightSel"></select>
      </div>

      <div class="meta">
        <div class="item">
          <span class="pill right-pill" data-i18n="right_pill">DIREITA</span>
          <div id="rightMeta"></div>
        </div>
      </div>

      <div class="hint" data-i18n="hint_right">Opcional: selecione um segundo l√∫pulo para compara√ß√£o.</div>
    </div>
  </div>

<script>
/* =====================  INTERNACIONALIZA√á√ÉO  ===================== */
const TRANSLATIONS = {
  pt: {
    title: "Radar de L√∫pulos ‚Äì Visualiza√ß√£o & Compara√ß√£o",
    subtitle: "Selecione um l√∫pulo para o <b>lado esquerdo</b> (azul) e, opcionalmente, outro para o <b>lado direito</b> (magenta). Passe o mouse no gr√°fico para ver os valores.",
    warning: "‚ö†Ô∏è Se algum l√∫pulo n√£o estiver inclu√≠do na lista, envie um email para: reisraff@gmail.com",
    controls: "Controles",
    filter_label: "Filtro r√°pido (por nome, pa√≠s ou estilo)",
    filter_placeholder: "Ex.: IPA, Alemanha, Citra...",
    left_label: "Lado Esquerdo (Azul)",
    right_label: "Lado Direito (Magenta)",
    left_selector_label: "Selecionar L√∫pulo",
    right_selector_label: "Selecionar L√∫pulo",
    left_pill: "ESQUERDA",
    right_pill: "DIREITA",
    hint: "Dica: use o filtro para reduzir a lista por pa√≠s (ex.: <i>US</i>, <i>DE</i>, <i>GB</i>) ou por um estilo (ex.: <i>NEIPA</i>, <i>K√∂lsch</i>).",
    hint_right: "Opcional: selecione um segundo l√∫pulo para compara√ß√£o.",
    chart_title: "Gr√°fico em Teia",
    legend_left: "Esquerda",
    legend_right: "Direita",
    legend_scale: "Escala 0‚Äì10",
    footnote: "As pontas representam as caracter√≠sticas com seus √≠cones: ‚òï Ch√°, üçã C√≠trico, üåø Verde, üçØ Caramelado, üå≥ Amadeirado, üå∂Ô∏è Picante, ‚ùÑÔ∏è Mentolado, üå± Herbal, ü•¨ Vegetal, üå∏ Floral, üçè Fruta Verde, üçì Fruta Vermelha, üçå Fruta Amarela, üçë Fruta Doce.",
    select_left: "‚Äî escolher ‚Äî",
    select_right: "‚Äî (opcional) ‚Äî",
    select_hop: "Selecione um l√∫pulo para popular os detalhes.",
    hop_name: "Nome:",
    hop_country: "Pa√≠s:",
    hop_styles: "Estilos:"
  },
  en: {
    title: "Hop Radar ‚Äì Visualization & Comparison",
    subtitle: "Select a hop for the <b>left side</b> (blue) and optionally another for the <b>right side</b> (magenta). Hover over the chart to see values.",
    warning: "‚ö†Ô∏è If any hop is not included in the list, send an email to: reisraff@gmail.com",
    controls: "Controls",
    filter_label: "Quick filter (by name, country or style)",
    filter_placeholder: "Ex.: IPA, Germany, Citra...",
    left_label: "Left Side (Blue)",
    right_label: "Right Side (Magenta)",
    left_selector_label: "Select Hop",
    right_selector_label: "Select Hop",
    left_pill: "LEFT",
    right_pill: "RIGHT",
    hint: "Tip: use the filter to narrow the list by country (ex.: <i>US</i>, <i>DE</i>, <i>GB</i>) or by style (ex.: <i>NEIPA</i>, <i>K√∂lsch</i>).",
    hint_right: "Optional: select a second hop for comparison.",
    chart_title: "Radar Chart",
    legend_left: "Left",
    legend_right: "Right",
    legend_scale: "Scale 0‚Äì10",
    footnote: "The points represent characteristics with their icons: ‚òï Tea, üçã Citrus, üåø Green, üçØ Caramel, üå≥ Woody, üå∂Ô∏è Spicy, ‚ùÑÔ∏è Menthol, üå± Herbal, ü•¨ Vegetal, üå∏ Floral, üçè Green Fruit, üçì Red Fruit, üçå Yellow Fruit, üçë Sweet Fruit.",
    select_left: "‚Äî choose ‚Äî",
    select_right: "‚Äî (optional) ‚Äî",
    select_hop: "Select a hop to populate details.",
    hop_name: "Name:",
    hop_country: "Country:",
    hop_styles: "Styles:"
  },
  es: {
    title: "Radar de L√∫pulos ‚Äì Visualizaci√≥n y Comparaci√≥n",
    subtitle: "Selecciona un l√∫pulo para el <b>lado izquierdo</b> (azul) y opcionalmente otro para el <b>lado derecho</b> (magenta). Pasa el mouse sobre el gr√°fico para ver los valores.",
    warning: "‚ö†Ô∏è Si alg√∫n l√∫pulo no est√° incluido en la lista, env√≠a un email a: reisraff@gmail.com",
    controls: "Controles",
    filter_label: "Filtro r√°pido (por nombre, pa√≠s o estilo)",
    filter_placeholder: "Ej.: IPA, Alemania, Citra...",
    left_label: "Lado Izquierdo (Azul)",
    right_label: "Lado Derecho (Magenta)",
    left_selector_label: "Seleccionar L√∫pulo",
    right_selector_label: "Seleccionar L√∫pulo",
    left_pill: "IZQUIERDA",
    right_pill: "DERECHA",
    hint: "Consejo: usa el filtro para reducir la lista por pa√≠s (ej.: <i>US</i>, <i>DE</i>, <i>GB</i>) o por estilo (ej.: <i>NEIPA</i>, <i>K√∂lsch</i>).",
    hint_right: "Opcional: selecciona un segundo l√∫pulo para comparaci√≥n.",
    chart_title: "Gr√°fico Radial",
    legend_left: "Izquierda",
    legend_right: "Derecha",
    legend_scale: "Escala 0‚Äì10",
    footnote: "Los puntos representan las caracter√≠sticas con sus √≠conos: ‚òï T√©, üçã C√≠trico, üåø Verde, üçØ Caramelo, üå≥ Amaderado, üå∂Ô∏è Picante, ‚ùÑÔ∏è Mentol, üå± Herbal, ü•¨ Vegetal, üå∏ Floral, üçè Fruta Verde, üçì Fruta Roja, üçå Fruta Amarilla, üçë Fruta Dulce.",
    select_left: "‚Äî elegir ‚Äî",
    select_right: "‚Äî (opcional) ‚Äî",
    select_hop: "Selecciona un l√∫pulo para mostrar detalles.",
    hop_name: "Nombre:",
    hop_country: "Pa√≠s:",
    hop_styles: "Estilos:"
  }
};

let currentLang = localStorage.getItem('hop-radar-lang') || 'pt';

/* =====================  DADOS (CSV incorporado)  ===================== */
const csv = `L√∫pulo,Pa√≠s,Ch√°,C√≠trico,Verde,Caramelado,Amadeirado,Picante,Mentolado,Herbal,Vegetal,Floral,Fruta Verde,Fruta Vermelha,Fruta Amarela,Fruta Doce,Estilos
Cascade,US,3,8,4,2,2,3,1,4,3,7,5,2,6,3,"APA, IPA, Blonde, Amber"
Centennial,US,3,8,4,3,3,4,1,4,2,6,5,3,7,3,"IPA, APA, Red Ale"
Chinook,US,2,7,5,3,4,6,2,4,3,4,4,2,5,3,"IPA, American Stout, Barleywine"
Citra,US,1,10,3,1,2,2,1,3,2,5,7,3,9,8,"IPA, NEIPA, Pale Ale"
Columbus (CTZ),US,3,6,5,2,5,7,2,5,4,3,3,2,4,2,"IPA, Imperial IPA, Porter"
Amarillo,US,2,8,3,2,2,3,1,3,2,8,6,4,8,6,"APA, IPA, Wheat Ale"
Simcoe,US,2,7,4,2,4,5,1,5,3,5,6,3,7,4,"IPA, NEIPA, Amber"
Mosaic,US,2,9,3,2,3,4,2,5,3,6,7,5,8,7,"IPA, NEIPA, APA"
El Dorado,US,1,8,2,2,2,2,1,3,2,5,6,5,9,8,"IPA, Fruit Ale"
Sabro,US,2,7,3,2,3,3,3,4,2,6,7,4,9,9,"NEIPA, Fruited IPA"
Idaho 7,US,2,8,3,2,3,4,2,5,3,6,6,4,8,6,"IPA, Hazy"
Cashmere,US,2,8,2,2,2,2,2,3,2,7,6,5,8,7,"APA, K√∂lsch moderna"
Ekuanot,EUA,2,8,4,2,3,3,3,5,3,6,6,4,8,6,"IPA, NEIPA, APA, Sour, Saison moderna"
Comet,US,3,7,4,2,3,4,1,5,3,6,7,3,7,4,"Pale Ale, Lager lupulada"
Hallertau Mittelfr√ºh,DE,7,2,3,3,4,5,2,8,4,7,2,1,2,2,"Lager, Pilsner"
Tradition,DE,6,3,3,3,4,5,2,8,4,6,3,2,2,2,"Helles, K√∂lsch"
Blanc,DE,3,8,3,2,2,3,2,4,2,6,6,5,8,7,"IPA, Saison moderna"
Magnum,DE,5,2,3,2,3,5,2,6,4,4,2,1,2,2,"Bock, Pils"
Tettnang,DE,6,3,3,3,3,5,2,7,4,6,3,2,2,2,"Lager, Wheat"
Spalt,DE,6,2,3,3,4,6,2,7,4,7,2,1,2,2,"Altbier, Pils"
Hersbrucker,DE,6,2,3,3,3,5,2,7,4,6,2,1,2,2,"Lager leve, Weiss"
Perle,DE,5,3,3,2,4,6,2,6,3,6,3,2,3,2,"Pilsner, K√∂lsch"
Mandarina Bavaria,DE,2,8,3,2,2,3,2,4,2,6,7,4,8,7,"IPA, Witbier"
Huell Melon,DE,2,6,3,2,2,2,1,3,2,6,6,4,8,8,"Saison, Wheat"
Polaris,DE,2,7,3,2,3,3,5,4,3,6,7,4,8,8,"IPA, Lager arom√°tica"
East Kent Goldings,GB,7,2,3,4,4,4,2,7,3,8,2,2,2,3,"ESB, Bitter"
Fuggle,GB,7,2,3,3,5,5,2,7,3,7,2,1,2,2,"Porter, Bitter"
Challenger,GB,5,3,3,3,4,5,2,6,3,6,3,2,3,2,"ESB, IPA inglesa"
Target,GB,5,3,3,3,5,6,2,6,3,5,3,2,3,2,"Bitter, IPA"
Northdown,GB,5,3,3,3,4,6,2,6,3,6,3,2,3,2,"Porter, Bitter"
Progress,GB,6,3,3,3,4,4,2,6,3,7,3,2,3,2,"Bitter, Mild"
Admiral,GB,5,4,3,3,4,5,2,5,3,6,3,2,4,2,"Bitter, IPA"
Saaz (≈Ωatec),CZ,8,2,3,3,3,5,2,9,4,8,2,1,2,2,"Pilsner, Lager"
Sl√°dek,CZ,6,5,3,3,3,4,2,6,3,6,4,3,5,3,Pilsner moderna
Premiant,CZ,6,4,3,3,3,4,2,6,3,6,3,2,4,3,"Lager, Pilsner"
Kazbek,CZ,5,6,3,2,3,4,2,5,3,6,5,3,6,4,Lager arom√°tica
Nelson Sauvin,NZ,2,7,3,2,3,3,2,4,2,6,8,3,6,5,"IPA, Saison"
Motueka,NZ,3,8,3,2,2,3,2,5,2,6,7,3,7,6,"Lager lupulada, IPA"
Riwaka,NZ,2,9,3,2,2,3,2,4,2,5,8,3,7,6,"NEIPA, APA"
Wai-iti,NZ,2,7,2,2,2,2,1,3,2,6,6,3,7,6,Pale Ale leve
Pacifica,NZ,3,6,3,3,3,3,2,6,3,6,5,2,5,4,"Lager, Pilsner"
Rakau,NZ,3,7,3,2,3,3,2,5,3,6,6,4,7,6,"IPA, APA"
Galaxy,AU,2,9,3,1,2,3,1,3,2,6,7,6,9,8,"NEIPA, Hazy"
Vic Secret,AU,2,8,3,2,3,3,2,4,2,5,7,4,8,7,"IPA, APA"
Ella,AU,3,7,3,2,3,3,2,5,2,6,6,4,7,6,"Saison, Belgian IPA"
Enigma,AU,2,8,3,2,3,3,2,4,2,6,7,4,8,7,"IPA, NEIPA"
Eclipse,AU,2,9,3,2,2,3,2,4,2,5,7,4,9,8,"NEIPA, Pale Ale"
Topaz,AU,3,7,3,2,3,4,2,5,3,6,6,4,7,6,"IPA, Pale Ale"
Strisselspalt,FR,7,2,3,3,4,4,2,7,3,8,2,1,2,2,"Lager, Belgian Ale"
Aramis,FR,6,4,3,3,3,5,2,6,3,7,4,3,5,3,Pilsner moderna
Barbe Rouge,FR,3,6,3,2,2,3,2,4,2,6,6,7,8,7,IPA frutada
Mistral,FR,3,6,3,2,3,3,2,5,2,6,6,4,7,6,"Saison, APA"
L√∫pulo Le√≥n,ES,6,4,3,3,4,4,2,6,3,7,4,3,4,3,Lager artesanal
Mapuche,AR/CH,5,6,3,3,3,4,2,5,3,6,4,3,5,4,"IPA, APA"
Cascade Patagonia,AR/CH,3,8,4,2,2,3,1,4,3,7,5,2,6,3,"APA, IPA"
Nugget Patagonia,AR/CH,4,5,4,3,4,6,2,6,3,6,3,2,4,3,"IPA, Stout"
Hallertau Tradition,DE,3,3,4,2,3,2,1,6,3,7,3,1,2,2,"Lager, Pilsner, Bock, Wheat"
Hallertau Blanc,DE,2,8,3,1,2,1,1,5,2,6,4,3,8,5,"IPA, Saison, Belgian Ale, White IPA"
Hallertau Magnum,DE,2,2,3,1,2,2,1,4,3,3,2,1,2,1,"Pilsner, Lager, Bock (amargor limpo)"
East Kent Goldings (EKG),GB,4,3,3,3,4,3,2,6,3,8,3,2,3,2,"Bitter, Pale Ale, ESB, Porter"
Bramling Cross,GB,3,4,3,2,3,3,2,5,3,6,3,7,3,2,"Bitter, ESB, Stout, Dark Ale"
Saaz,CZ,3,2,4,2,2,5,2,7,3,8,2,1,2,1,"Pilsner, Lager, Belgian Ale"
Pacific Jade,NZ,2,7,4,2,3,6,2,6,3,5,4,3,7,4,"IPA, Pale Ale, Lager, Strong Ale"
Wakatu,NZ,3,7,4,2,3,2,2,6,3,7,4,2,8,4,"Pale Ale, Lager, Blonde Ale, Golden Ale"`;
/* =====================  Utilidades  ===================== */
// Mapa de pa√≠ses para c√≥digos ISO dos flags
const COUNTRY_FLAGS = {
  'US': 'us', 'EUA': 'us',
  'DE': 'de',
  'GB': 'gb',
  'CZ': 'cz',
  'NZ': 'nz',
  'AU': 'au',
  'FR': 'fr',
  'ES': 'es',
  'AR/CH': 'ar', // Argentina para o h√≠brido AR/CH
  'AR': 'ar',
  'CH': 'cl'
};

function getFlagUrl(countryCode) {
  const isoCode = COUNTRY_FLAGS[countryCode] || countryCode.toLowerCase();
  return `https://flagcdn.com/16x12/${isoCode}.png`;
}

function createFlagElement(countryCode) {
  if (!countryCode) return '';
  const flagUrl = getFlagUrl(countryCode);
  return `<span class="flag" style="background-image:url('${flagUrl}')" title="${countryCode}"></span>`;
}
const ATTRS = ["Ch√°","C√≠trico","Verde","Caramelado","Amadeirado","Picante","Mentolado","Herbal","Vegetal","Floral","Fruta Verde","Fruta Vermelha","Fruta Amarela","Fruta Doce"];

// Mapeamento de √≠cones para cada caracter√≠stica
const ATTR_ICONS = {
  "Ch√°": "‚òï",
  "C√≠trico": "üçã", 
  "Verde": "üåø",
  "Caramelado": "üçØ",
  "Amadeirado": "üå≥",
  "Picante": "üå∂Ô∏è",
  "Mentolado": "‚ùÑÔ∏è",
  "Herbal": "üå±",
  "Vegetal": "ü•¨",
  "Floral": "üå∏",
  "Fruta Verde": "üçè",
  "Fruta Vermelha": "üçì",
  "Fruta Amarela": "üçå",
  "Fruta Doce": "üçë"
};

// Vers√µes com √≠cones dos atributos
const ATTRS_WITH_ICONS = ATTRS.map(attr => `${ATTR_ICONS[attr]} ${attr}`);
function parseCSV(text){
  // parse simples, suficiente para este CSV (aspas apenas em Estilos)
  const lines = text.trim().split(/\r?\n/);
  const headers = lines.shift().split(",");
  return lines.map(line=>{
    // separa por v√≠rgula, respeitando campo final possivelmente com v√≠rgulas dentro de aspas
    const parts = [];
    let cur = "", inQuotes=false;
    for (let i=0;i<line.length;i++){
      const ch=line[i];
      if(ch === '"' ){ inQuotes = !inQuotes; continue; }
      if(ch === ',' && !inQuotes){ parts.push(cur); cur=""; }
      else cur += ch;
    }
    parts.push(cur);
    const obj = {};
    headers.forEach((h,idx)=> obj[h.trim()] = parts[idx]?.trim() ?? "");
    // n√∫meros para atributos
    ATTRS.forEach(a=> obj[a] = Number(obj[a]));
    // estilos em array
    obj.Estilos = (obj.Estilos||"").split(",").map(s=>s.trim()).filter(Boolean);
    // normaliza campos nome/pa√≠s
    obj.nome = obj["L√∫pulo"];
    obj.pais = obj["Pa√≠s"];
    return obj;
  });
}
const DATA = parseCSV(csv);

// mapa para lookup r√°pido
const byName = new Map(DATA.map(d=>[d.nome, d]));

/* =====================  DOM  ===================== */
const leftSel  = document.getElementById('leftSel');
const rightSel = document.getElementById('rightSel');
const qInput   = document.getElementById('q');
const q2Input  = document.getElementById('q2');
const leftMeta = document.getElementById('leftMeta');
const rightMeta= document.getElementById('rightMeta');

function formatStyles(arr){ return arr.map(s=>`<span class="tag">${s}</span>`).join(" "); }
function renderMeta(side, hop){
  const t = TRANSLATIONS[currentLang];
  const html = hop ? `
    <div><b>${t.hop_name}</b> ${hop.nome}</div>
    <div><b>${t.hop_country}</b> ${hop.pais}${createFlagElement(hop.pais)}</div>
    <div><b>${t.hop_styles}</b><div class="styles">${formatStyles(hop.Estilos)}</div></div>
  ` : `<div style="color:#7f89b4">${t.select_hop}</div>`;
  (side==='left'?leftMeta:rightMeta).innerHTML = html;
}

let leftOptionsList = [...DATA];
let rightOptionsList = [...DATA];

/* popula selects */
function fillLeftSelect(list){
  const t = TRANSLATIONS[currentLang];
  const opts = list.map(d=>`<option value="${d.nome}">${d.nome} (${d.pais})</option>`).join("");
  leftSel.innerHTML  = `<option value="">${t.select_left}</option>` + opts;
}

function fillRightSelect(list){
  const t = TRANSLATIONS[currentLang];
  const opts = list.map(d=>`<option value="${d.nome}">${d.nome} (${d.pais})</option>`).join("");
  rightSel.innerHTML = `<option value="">${t.select_right}</option>` + opts;
}

function fillSelects(list){
  fillLeftSelect(list);
  fillRightSelect(list);
}

/* filtro de busca esquerdo */
function applyLeftFilter(){
  const q = qInput.value.trim().toLowerCase();
  if(!q){ leftOptionsList = [...DATA]; fillLeftSelect(leftOptionsList); return; }
  leftOptionsList = DATA.filter(d=>{
    const hay = [d.nome, d.pais, ...(d.Estilos||[])].join(" ").toLowerCase();
    return hay.includes(q);
  });
  fillLeftSelect(leftOptionsList);
}

/* filtro de busca direito */
function applyRightFilter(){
  const q = q2Input.value.trim().toLowerCase();
  if(!q){ rightOptionsList = [...DATA]; fillRightSelect(rightOptionsList); return; }
  rightOptionsList = DATA.filter(d=>{
    const hay = [d.nome, d.pais, ...(d.Estilos||[])].join(" ").toLowerCase();
    return hay.includes(q);
  });
  fillRightSelect(rightOptionsList);
}

qInput.addEventListener('input', applyLeftFilter);
q2Input.addEventListener('input', applyRightFilter);

/* =====================  CHART (Radar)  ===================== */
const ctx = document.getElementById('radar').getContext('2d');

const gridColor = getComputedStyle(document.documentElement).getPropertyValue('--ring').trim() || '#2a335a';

const radar = new Chart(ctx, {
  type: 'radar',
  data: {
    labels: ATTRS_WITH_ICONS,
    datasets: [
      {
        label: 'Esquerda',
        data: [], // preenchido ao selecionar
        backgroundColor: 'rgba(76,141,246,0.22)',
        borderColor: 'rgba(76,141,246,1)',
        pointBackgroundColor: 'rgba(76,141,246,1)',
        pointRadius: 3,
        borderWidth: 2,
        order: 1
      },
      {
        label: 'Direita',
        data: [],
        backgroundColor: 'rgba(230,91,183,0.22)',
        borderColor: 'rgba(230,91,183,1)',
        pointBackgroundColor: 'rgba(230,91,183,1)',
        pointRadius: 3,
        borderWidth: 2,
        order: 2
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      r: {
        min: 0, max: 10, ticks: { stepSize: 2, showLabelBackdrop:false, color:'#aeb7da' },
        grid: { color: gridColor },
        angleLines: { color: gridColor },
        pointLabels: {
          color: '#dfe6ff',
          font: { size: 11, weight: 500, family: 'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Apple Color Emoji", "Segoe UI Emoji", sans-serif' }
        }
      }
    },
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          title: (ctx)=> ctx[0].label,
          label: (ctx)=> `${ctx.dataset.label}: ${ctx.formattedValue}`
        }
      }
    },
    elements: {
      line: { tension: 0.25 }
    },
    animation: { duration: 350 }
  }
});

/* helpers para extrair vetor de atributos */
function vector(hop){
  return ATTRS.map(a => hop[a] ?? 0);
}

/* atualiza gr√°fico e metadados */
function update(){
  const leftName  = leftSel.value;
  const rightName = rightSel.value;

  const left  = byName.get(leftName);
  const right = byName.get(rightName);

  radar.data.datasets[0].data = left  ? vector(left)  : [];
  radar.data.datasets[1].data = right ? vector(right) : [];

  renderMeta('left', left);
  renderMeta('right', right);

  radar.update();
}

/* =====================  INTERNACIONALIZA√á√ÉO - FUN√á√ïES  ===================== */
function updateTexts() {
  const t = TRANSLATIONS[currentLang];
  
  // Atualiza todos os elementos com data-i18n
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (t[key]) {
      el.innerHTML = t[key];
    }
  });
  
  // Atualiza placeholders
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    const key = el.getAttribute('data-i18n-placeholder');
    if (t[key]) {
      el.placeholder = t[key];
    }
  });
  
  // Atualiza labels do chart
  radar.data.datasets[0].label = t.legend_left;
  radar.data.datasets[1].label = t.legend_right;
  radar.update();
  
  // Recarrega selects e metadados
  fillSelects(leftOptionsList);
  update();
}

function switchLanguage(lang) {
  currentLang = lang;
  localStorage.setItem('hop-radar-lang', lang);
  
  // Atualiza bot√µes ativos
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.lang === lang);
  });
  
  updateTexts();
}

/* listeners */
leftSel.addEventListener('change', update);
rightSel.addEventListener('change', update);

// Language switching
document.querySelectorAll('.lang-btn').forEach(btn => {
  btn.addEventListener('click', () => switchLanguage(btn.dataset.lang));
});

/* inicializa√ß√£o */
// Configura idioma inicial
switchLanguage(currentLang);

/* pr√©-sele√ß√µes simp√°ticas */
const defaultLeft = byName.has('Cascade') ? 'Cascade' : DATA[0].nome;
const defaultRight = byName.has('Citra') ? 'Citra' : (DATA[1]?.nome ?? '');
leftSel.value = defaultLeft;
rightSel.value = defaultRight;
update();
</script>
</body>
</html>
