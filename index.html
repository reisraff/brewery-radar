<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hop Radar – View & Compare Hops</title>
<!-- Chart.js via CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<style>
  :root{
    --bg:#0b1020;
    --card:#131a33;
    --muted:#a8b3cf;
    --text:#e8ecf8;
    --brand-left:#4c8df6;   /* azul (Esquerda) */
    --brand-right:#e65bb7;  /* magenta (Direita) */
    --ring:#2a335a;
  }
  *{box-sizing:border-box}
  body{
    margin:0; padding:24px;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    color:var(--text); background: radial-gradient(1200px 700px at 20% -10%, #1c2550 0%, var(--bg) 35%), var(--bg);
  }
  h1{font-size:clamp(20px,3vw,28px); margin:0 0 8px 0; letter-spacing:.2px}
  .sub{color:var(--muted); margin-bottom:22px}
  .container{
    display:grid; gap:18px;
    grid-template-columns: 320px 1fr 320px;
  }
  @media (max-width: 1200px){
    .container{grid-template-columns: 280px 1fr 280px; gap:12px}
  }
  @media (max-width: 980px){
    .container{
      grid-template-columns: 1fr;
      grid-template-rows: auto auto auto;
    }
    .left-panel { order: 1; }
    .chart-panel { order: 3; }
    .right-panel { order: 2; }
  }
  .panel{
    background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    border:1px solid #1f2647;
    border-radius:16px;
    padding:16px;
    box-shadow: 0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.05);
  }
  .panel h2{margin:2px 0 12px 0; font-size:16px; color:#ced7ff; font-weight:700}
  .row{display:flex; gap:10px; margin-bottom:10px}
  label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px}
  select, input[type="text"]{
    width:100%;
    background:#0f1530; color:var(--text);
    border:1px solid #27305a; border-radius:10px;
    padding:10px 12px; outline:none;
    font-size:14px; transition:border .2s, box-shadow .2s;
  }
  select:focus, input[type="text"]:focus{
    border-color:#5a6ee5; box-shadow:0 0 0 3px rgba(90,110,229,.25)
  }
  .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 10px; border-radius:999px; font-weight:600; font-size:12px; letter-spacing:.2px
  }
  .left-pill{background:rgba(76,141,246,.12); color:#cfe1ff; border:1px solid rgba(76,141,246,.35)}
  .right-pill{background:rgba(230,91,183,.12); color:#ffd1ef; border:1px solid rgba(230,91,183,.35)}
  .meta{
    display:grid; gap:8px; margin-top:6px
  }
  .meta .item{
    background:#0f1530; border:1px solid #27305a; border-radius:10px; padding:10px 12px;
  }
  .meta .item b{color:#cfd7ff; font-size:12px}
  .styles{display:flex; flex-wrap:wrap; gap:6px; margin-top:6px}
  .tag{
    background:#0a112b; color:#d7def9; border:1px solid #243062;
    font-size:12px; padding:6px 8px; border-radius:999px
  }
  .header{
    display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px
  }
  .legend{
    display:flex; gap:8px; align-items:center; flex-wrap:wrap
  }
  .legend .key{
    display:inline-flex; align-items:center; gap:6px; font-size:12px; color:var(--muted)
  }
  .dot{
    width:10px; height:10px; border-radius:50%
  }
  .hint{color:var(--muted); font-size:12px; margin-top:10px}
  canvas{width:100% !important; height:auto !important; max-height:70vh}
  #chemicalChart, #compoundsChart{max-height:35vh !important}
  .chart-container{position:relative; font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif}
  .footnote{margin-top:10px; font-size:12px; color:#9fb0ff}
  .search{margin-bottom:10px}
  .tabs{
    display:flex; gap:2px; margin-bottom:18px;
    background:rgba(255,255,255,.04); border:1px solid #1f2647;
    border-radius:8px; padding:4px;
  }
  .tab-btn{
    background:transparent; border:none; color:var(--muted);
    padding:8px 16px; border-radius:6px; cursor:pointer;
    font-size:14px; font-weight:600;
    transition:all .2s;
  }
  .tab-btn:hover{background:rgba(255,255,255,.08); color:var(--text)}
  .tab-btn.active{background:var(--brand-left); color:#fff}
  .tab-content{display:none}
  .tab-content.active{display:block}
  .lang-selector{
    position:absolute; top:24px; right:24px;
    background:rgba(255,255,255,.04); border:1px solid #1f2647;
    border-radius:8px; padding:4px;
    display:flex; gap:2px;
  }
  .lang-btn{
    background:transparent; border:none; color:var(--muted);
    padding:6px 8px; border-radius:6px; cursor:pointer;
    font-size:11px; font-weight:600; text-transform:uppercase;
    transition:all .2s;
  }
  .lang-btn:hover{background:rgba(255,255,255,.08); color:var(--text)}
  .lang-btn.active{background:var(--brand-left); color:#fff}
  .flag{
    width:16px; height:12px; border-radius:2px; display:inline-block;
    margin-left:6px; vertical-align:middle; border:1px solid rgba(255,255,255,.15);
    background-size:cover; background-position:center;
  }
</style>
</head>
<body>
  <div class="lang-selector">
    <button class="lang-btn active" data-lang="pt">PT</button>
    <button class="lang-btn" data-lang="en">EN</button>
    <button class="lang-btn" data-lang="es">ES</button>
  </div>
  
  <h1 data-i18n="title">Radar de Lúpulos – Visualização & Comparação</h1>
  <div class="sub" data-i18n="subtitle">Selecione um lúpulo para o <b>lado esquerdo</b> (azul) e, opcionalmente, outro para o <b>lado direito</b> (magenta). Passe o mouse no gráfico para ver os valores.</div>
  <div class="sub" style="color: #f59e0b; margin-top: 8px;" data-i18n="warning">⚠️ se algum item não estiver incluido na lista ou estiver incorreto, envie um email para reisraff@gmail.com</div>

  <div class="container">
    <!-- Painel esquerdo -->
    <div class="panel left-panel">
      <h2 data-i18n="left_label">Lado Esquerdo (Azul)</h2>

      <div class="search">
        <label for="q" data-i18n="filter_label">Filtro rápido (por nome, país ou estilo)</label>
        <input id="q" type="text" data-i18n-placeholder="filter_placeholder" placeholder="Ex.: IPA, Alemanha, Citra..." />
      </div>

      <div>
        <label for="leftSel" data-i18n="left_selector_label">Selecionar Lúpulo</label>
        <select id="leftSel"></select>
      </div>

      <div class="meta">
        <div class="item">
          <span class="pill left-pill" id="leftPill">ESQUERDA</span>
          <div id="leftMeta"></div>
        </div>
      </div>

      <div class="hint" data-i18n="hint">Dica: use o filtro para reduzir a lista por país (ex.: <i>US</i>, <i>DE</i>, <i>GB</i>) ou por um estilo (ex.: <i>NEIPA</i>, <i>Kölsch</i>).</div>
    </div>

    <!-- Painel do gráfico -->
    <div class="panel chart-panel">
      <!-- Abas -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="aroma" data-i18n="tab_aroma">Perfil Aromático</button>
        <button class="tab-btn" data-tab="chemical" data-i18n="tab_chemical">Composição Química</button>
      </div>

      <!-- Conteúdo da aba Aroma -->
      <div class="tab-content active" id="aroma-content">
        <div class="header">
          <h2 style="margin:0" data-i18n="chart_title">Gráfico em Teia</h2>
          <div class="legend">
            <span class="key"><span class="dot" style="background:var(--brand-left)"></span> <span id="leftLegend">Esquerda</span></span>
            <span class="key"><span class="dot" style="background:var(--brand-right)"></span> <span id="rightLegend">Direita</span></span>
            <span class="key" data-i18n="legend_scale">Escala 0–10</span>
          </div>
        </div>
        <canvas id="radar"></canvas>
        <div class="footnote" data-i18n="footnote">As pontas representam as características: Chá, Cítrico, Verde, Caramelado, Amadeirado, Picante, Mentolado, Herbal, Vegetal, Floral, Fruta Verde, Fruta Vermelha, Fruta Amarela, Fruta Doce.</div>
      </div>

      <!-- Conteúdo da aba Química -->
      <div class="tab-content" id="chemical-content">
        <div class="header">
          <h2 style="margin:0" data-i18n="chemical_title">Composição Química</h2>
          <div class="legend">
            <span class="key"><span class="dot" style="background:var(--brand-left)"></span> <span id="leftLegendChem">Esquerda</span></span>
            <span class="key"><span class="dot" style="background:var(--brand-right)"></span> <span id="rightLegendChem">Direita</span></span>
            <span class="key" data-i18n="legend_percent">% / ml/100g</span>
          </div>
        </div>
        <canvas id="chemicalChart"></canvas>
        <div class="footnote" data-i18n="chemical_footnote">Comparação dos níveis de ácidos alfa, ácidos beta e óleos essenciais totais.</div>
        
        <!-- Segundo gráfico químico - Compostos -->
        <div class="header" style="margin-top: 24px;">
          <h2 style="margin:0" data-i18n="compounds_title">Compostos Aromáticos</h2>
          <div class="legend">
            <span class="key"><span class="dot" style="background:var(--brand-left)"></span> <span id="leftLegendCompounds">Esquerda</span></span>
            <span class="key"><span class="dot" style="background:var(--brand-right)"></span> <span id="rightLegendCompounds">Direita</span></span>
            <span class="key" data-i18n="legend_percent">% / ml/100g</span>
          </div>
        </div>
        <canvas id="compoundsChart"></canvas>
        <div class="footnote" data-i18n="compounds_footnote">Comparação dos compostos aromáticos: Mirceno, Humuleno, Cariofileno, Farneseno, Linalol, Geraniol e Polifenóis.</div>
      </div>
    </div>

    <!-- Painel direito -->
    <div class="panel right-panel">
      <h2 data-i18n="right_label">Lado Direito (Magenta)</h2>

      <div class="search">
        <label for="q2" data-i18n="filter_label">Filtro rápido (por nome, país ou estilo)</label>
        <input id="q2" type="text" data-i18n-placeholder="filter_placeholder" placeholder="Ex.: IPA, Alemanha, Citra..." />
      </div>

      <div>
        <label for="rightSel" data-i18n="right_selector_label">Selecionar Lúpulo</label>
        <select id="rightSel"></select>
      </div>

      <div class="meta">
        <div class="item">
          <span class="pill right-pill" id="rightPill">DIREITA</span>
          <div id="rightMeta"></div>
        </div>
      </div>

      <div class="hint" data-i18n="hint_right">Opcional: selecione um segundo lúpulo para comparação.</div>
    </div>
  </div>

<script>
/* =====================  INTERNACIONALIZAÇÃO  ===================== */
const TRANSLATIONS = {
  pt: {
    title: "Radar de Lúpulos – Visualização & Comparação",
    subtitle: "Selecione um lúpulo para o <b>lado esquerdo</b> (azul) e, opcionalmente, outro para o <b>lado direito</b> (magenta). Passe o mouse no gráfico para ver os valores.",
    warning: "⚠️ se algum item não estiver incluido na lista ou estiver incorreto, envie um email para reisraff@gmail.com",
    controls: "Controles",
    filter_label: "Filtro rápido (por nome, país ou estilo)",
    filter_placeholder: "Ex.: IPA, Alemanha, Citra...",
    left_label: "Lado Esquerdo (Azul)",
    right_label: "Lado Direito (Magenta)",
    left_selector_label: "Selecionar Lúpulo",
    right_selector_label: "Selecionar Lúpulo",
    left_pill: "ESQUERDA",
    right_pill: "DIREITA",
    hint: "Dica: use o filtro para reduzir a lista por país (ex.: <i>US</i>, <i>DE</i>, <i>GB</i>) ou por um estilo (ex.: <i>NEIPA</i>, <i>Kölsch</i>).",
    hint_right: "Opcional: selecione um segundo lúpulo para comparação.",
    chart_title: "Gráfico em Teia",
    legend_left: "Esquerda",
    legend_right: "Direita",
    legend_scale: "Escala 0–10",
    footnote: "As pontas representam as características com seus ícones: ☕ Chá, 🍋 Cítrico, 🌿 Verde, 🍯 Caramelado, 🌳 Amadeirado, 🌶️ Picante, ❄️ Mentolado, 🌱 Herbal, 🥬 Vegetal, 🌸 Floral, 🍏 Fruta Verde, 🍓 Fruta Vermelha, 🍌 Fruta Amarela, 🍑 Fruta Doce.",
    select_left: "— escolher —",
    select_right: "— (opcional) —",
    select_hop: "Selecione um lúpulo para popular os detalhes.",
    hop_name: "Nome:",
    hop_country: "País:",
    hop_styles: "Estilos:",
    tab_aroma: "Perfil Aromático",
    tab_chemical: "Composição Química",
    chemical_title: "Composição Química",
    chemical_footnote: "Comparação dos níveis de ácidos alfa, ácidos beta e óleos essenciais totais.",
    compounds_title: "Compostos Aromáticos",
    compounds_footnote: "Comparação dos compostos aromáticos: Mirceno, Humuleno, Cariofileno, Farneseno, Linalol, Geraniol e Polifenóis.",
    legend_percent: "% / ml/100g"
  },
  en: {
    title: "Hop Radar – Visualization & Comparison",
    subtitle: "Select a hop for the <b>left side</b> (blue) and optionally another for the <b>right side</b> (magenta). Hover over the chart to see values.",
    warning: "⚠️ If any item is not included in the list or is incorrect, send an email to reisraff@gmail.com",
    controls: "Controls",
    filter_label: "Quick filter (by name, country or style)",
    filter_placeholder: "Ex.: IPA, Germany, Citra...",
    left_label: "Left Side (Blue)",
    right_label: "Right Side (Magenta)",
    left_selector_label: "Select Hop",
    right_selector_label: "Select Hop",
    left_pill: "LEFT",
    right_pill: "RIGHT",
    hint: "Tip: use the filter to narrow the list by country (ex.: <i>US</i>, <i>DE</i>, <i>GB</i>) or by style (ex.: <i>NEIPA</i>, <i>Kölsch</i>).",
    hint_right: "Optional: select a second hop for comparison.",
    chart_title: "Radar Chart",
    legend_left: "Left",
    legend_right: "Right",
    legend_scale: "Scale 0–10",
    footnote: "The points represent characteristics with their icons: ☕ Tea, 🍋 Citrus, 🌿 Green, 🍯 Caramel, 🌳 Woody, 🌶️ Spicy, ❄️ Menthol, 🌱 Herbal, 🥬 Vegetal, 🌸 Floral, 🍏 Green Fruit, 🍓 Red Fruit, 🍌 Yellow Fruit, 🍑 Sweet Fruit.",
    select_left: "— choose —",
    select_right: "— (optional) —",
    select_hop: "Select a hop to populate details.",
    hop_name: "Name:",
    hop_country: "Country:",
    hop_styles: "Styles:",
    tab_aroma: "Aroma Profile",
    tab_chemical: "Chemical Composition",
    chemical_title: "Chemical Composition",
    chemical_footnote: "Comparison of alpha acid, beta acid and total essential oil levels.",
    compounds_title: "Aromatic Compounds",
    compounds_footnote: "Comparison of aromatic compounds: Myrcene, Humulene, Caryophyllene, Farnesene, Linalool, Geraniol and Polyphenols.",
    legend_percent: "% / ml/100g"
  },
  es: {
    title: "Radar de Lúpulos – Visualización y Comparación",
    subtitle: "Selecciona un lúpulo para el <b>lado izquierdo</b> (azul) y opcionalmente otro para el <b>lado derecho</b> (magenta). Pasa el mouse sobre el gráfico para ver los valores.",
    warning: "⚠️ Si algún elemento no está incluido en la lista o es incorrecto, envía un email a reisraff@gmail.com",
    controls: "Controles",
    filter_label: "Filtro rápido (por nombre, país o estilo)",
    filter_placeholder: "Ej.: IPA, Alemania, Citra...",
    left_label: "Lado Izquierdo (Azul)",
    right_label: "Lado Derecho (Magenta)",
    left_selector_label: "Seleccionar Lúpulo",
    right_selector_label: "Seleccionar Lúpulo",
    left_pill: "IZQUIERDA",
    right_pill: "DERECHA",
    hint: "Consejo: usa el filtro para reducir la lista por país (ej.: <i>US</i>, <i>DE</i>, <i>GB</i>) o por estilo (ej.: <i>NEIPA</i>, <i>Kölsch</i>).",
    hint_right: "Opcional: selecciona un segundo lúpulo para comparación.",
    chart_title: "Gráfico Radial",
    legend_left: "Izquierda",
    legend_right: "Derecha",
    legend_scale: "Escala 0–10",
    footnote: "Los puntos representan las características con sus íconos: ☕ Té, 🍋 Cítrico, 🌿 Verde, 🍯 Caramelo, 🌳 Amaderado, 🌶️ Picante, ❄️ Mentol, 🌱 Herbal, 🥬 Vegetal, 🌸 Floral, 🍏 Fruta Verde, 🍓 Fruta Roja, 🍌 Fruta Amarilla, 🍑 Fruta Dulce.",
    select_left: "— elegir —",
    select_right: "— (opcional) —",
    select_hop: "Selecciona un lúpulo para mostrar detalles.",
    hop_name: "Nombre:",
    hop_country: "País:",
    hop_styles: "Estilos:",
    tab_aroma: "Perfil Aromático",
    tab_chemical: "Composición Química",
    chemical_title: "Composición Química",
    chemical_footnote: "Comparación de los niveles de ácidos alfa, ácidos beta y aceites esenciales totales.",
    compounds_title: "Compuestos Aromáticos",
    compounds_footnote: "Comparación de compuestos aromáticos: Mirceno, Humuleno, Cariofileno, Farneseno, Linalol, Geraniol y Polifenoles.",
    legend_percent: "% / ml/100g"
  }
};

let currentLang = localStorage.getItem('hop-radar-lang') || 'pt';

/* =====================  DADOS (CSV incorporado)  ===================== */
const csv = `Lúpulo,País,Chá,Cítrico,Verde,Caramelado,Amadeirado,Picante,Mentolado,Herbal,Vegetal,Floral,Fruta Verde,Fruta Vermelha,Fruta Amarela,Fruta Doce,Estilos,AA_min_%,AA_max_%,BA_min_%,BA_max_%,Oils_min_ml_100g,Oils_max_ml_100g,Myrcene_min_%,Myrcene_max_%,Humulene_min_%,Humulene_max_%,Caryophyllene_min_%,Caryophyllene_max_%,Farnesene_min_%,Farnesene_max_%,Linalool_min_%,Linalool_max_%,Geraniol_min_%,Geraniol_max_%,Polyphenols_min_%,Polyphenols_max_%
Cascade,US,3,8,4,2,2,3,1,4,3,7,5,2,6,3,"APA, IPA, Blonde, Amber",4.0,9.0,5.5,9.0,0.5,2.0,40.0,60.0,10.0,20.0,4.0,10.0,4.5,8.5,0.1,0.6,0.1,0.5,,
Centennial,US,3,8,4,3,3,4,1,4,2,6,5,3,7,3,"IPA, APA, Red Ale",7.0,12.0,3.5,5.5,1.0,3.0,55.0,65.0,10.0,20.0,5.0,7.0,0.0,1.0,0.6,0.9,1.2,1.8,,
Chinook,US,2,7,5,3,4,6,2,4,3,4,4,2,5,3,"IPA, American Stout, Barleywine",11.0,15.0,3.0,4.0,1.5,3.0,35.0,45.0,18.0,24.0,9.0,12.0,0.0,1.0,0.4,0.8,0.2,0.6,,
Citra,US,1,10,3,1,2,2,1,3,2,5,7,3,9,8,"IPA, NEIPA, Pale Ale",10.0,16.0,3.5,4.5,2.2,2.8,60.0,65.0,11.0,13.0,6.0,8.0,0.0,1.0,1.0,2.0,,,4.5,5.5
Columbus (CTZ),US,3,6,5,2,5,7,2,5,4,3,3,2,4,2,"IPA, Imperial IPA, Porter",15.0,18.0,4.5,6.0,2.0,4.0,45.0,60.0,9.0,14.0,6.0,10.0,0.1,1.0,0.3,0.6,0.2,0.8,,
Amarillo,US,2,8,3,2,2,3,1,3,2,8,6,4,8,6,"APA, IPA, Wheat Ale",8.0,11.0,6.0,7.0,1.5,2.5,60.0,70.0,8.0,20.0,5.0,10.0,0.0,1.0,0.6,1.2,0.2,0.8,,
Simcoe,US,2,7,4,2,4,5,1,5,3,5,6,3,7,4,"IPA, NEIPA, Amber",12.0,16.0,4.0,5.0,2.0,4.5,50.0,65.0,12.0,20.0,6.0,10.0,0.0,1.0,0.5,0.9,0.2,0.8,,
Mosaic,US,2,9,3,2,3,4,2,5,3,6,7,5,8,7,"IPA, NEIPA, APA",10.0,14.0,3.0,4.5,1.0,3.0,45.0,55.0,10.0,16.0,5.0,9.0,0.0,1.0,0.4,0.8,0.2,0.6,,
El Dorado,US,1,8,2,2,2,2,1,3,2,5,6,5,9,8,"IPA, Fruit Ale",13.0,17.0,7.0,8.0,1.5,2.5,50.0,60.0,10.0,16.0,5.0,8.0,0.0,1.0,0.3,0.7,0.1,0.5,,
Sabro,US,2,7,3,2,3,3,3,4,2,6,7,4,9,9,"NEIPA, Fruited IPA",12.0,16.0,4.0,5.0,2.0,3.5,35.0,50.0,10.0,16.0,6.0,10.0,0.0,1.0,0.5,1.0,0.5,1.0,,
Idaho 7,US,2,8,3,2,3,4,2,5,3,6,6,4,8,6,"IPA, Hazy",9.0,14.0,5.0,7.0,1.0,3.0,40.0,55.0,10.0,18.0,6.0,9.0,0.0,1.0,0.5,1.0,0.2,0.8,,
Cashmere,US,2,8,2,2,2,2,2,3,2,7,6,5,8,7,"APA, Kölsch moderna",7.7,9.1,6.4,7.1,1.2,1.4,39.0,42.0,26.0,29.0,11.5,13.0,0.0,1.0,0.3,0.7,0.1,0.4,,
Ekuanot,US,2,8,4,2,3,3,3,5,3,6,6,4,8,6,"IPA, NEIPA, APA, Sour, Saison moderna",13.0,16.0,4.5,5.5,2.0,4.0,50.0,55.0,10.0,15.0,8.0,10.0,0.0,1.0,0.7,1.2,0.3,0.8,,
Comet,US,3,7,4,2,3,4,1,5,3,6,7,3,7,4,"Pale Ale, Lager lupulada",9.0,12.0,3.0,4.5,1.0,2.0,35.0,55.0,10.0,20.0,6.0,10.0,0.0,1.0,0.3,0.7,0.2,0.6,,
Hallertau Mittelfrüh,DE,7,2,3,3,4,5,2,8,4,7,2,1,2,2,"Lager, Pilsner",3.0,5.5,3.0,5.0,0.5,1.3,20.0,30.0,30.0,40.0,6.0,12.0,0.1,1.0,0.7,1.1,0.1,0.3,,
Tradition,DE,6,3,3,3,4,5,2,8,4,6,3,2,2,2,"Helles, Kölsch",4.0,7.0,3.0,5.5,0.8,1.5,20.0,35.0,25.0,35.0,7.0,12.0,0.1,1.0,,,,,,
Blanc,DE,3,8,3,2,2,3,2,4,2,6,6,5,8,7,"IPA, Saison moderna",9.0,12.0,5.0,6.5,1.2,1.8,20.0,30.0,30.0,40.0,8.0,12.0,0.1,1.0,0.6,1.0,,,,
Magnum,DE,5,2,3,2,3,5,2,6,4,4,2,1,2,2,"Bock, Pils",11.0,16.0,5.0,7.0,1.4,2.1,45.0,55.0,18.0,22.0,7.0,10.0,,,,,,,,
Tettnang,DE,6,3,3,3,3,5,2,7,4,6,3,2,2,2,"Lager, Wheat",3.0,6.0,3.0,5.0,0.5,1.0,20.0,35.0,20.0,30.0,8.0,12.0,0.0,1.0,,,,,,
Spalt,DE,6,2,3,3,4,6,2,7,4,7,2,1,2,2,"Altbier, Pils",2.5,5.5,3.0,5.0,0.5,0.9,20.0,35.0,20.0,30.0,8.0,13.0,12.0,18.0,0.3,0.8,0.2,0.5,,
Hersbrucker,DE,6,2,3,3,3,5,2,7,4,6,2,1,2,2,"Lager leve, Weiss",2.0,5.0,2.5,5.0,0.5,1.0,20.0,35.0,30.0,40.0,8.0,12.0,0.1,1.0,,,,,,
Perle,DE,5,3,3,2,4,6,2,6,3,6,3,2,3,2,"Pilsner, Kölsch",6.0,9.0,2.5,4.5,0.8,1.5,35.0,50.0,18.0,25.0,8.0,12.0,,,,,,,,
Mandarina Bavaria,DE,2,8,3,2,2,3,2,4,2,6,7,4,8,7,"IPA, Witbier",7.0,10.0,5.0,6.5,1.5,2.3,35.0,45.0,18.0,25.0,7.0,10.0,,,0.8,1.5,,,,
Huell Melon,DE,2,6,3,2,2,2,1,3,2,6,6,4,8,8,"Saison, Wheat",6.0,8.0,6.0,8.0,0.8,1.5,30.0,40.0,20.0,30.0,8.0,12.0,,,0.6,1.2,,,,
Polaris,DE,2,7,3,2,3,3,5,4,3,6,7,4,8,8,"IPA, Lager aromática",18.0,23.0,3.0,5.0,2.5,4.5,40.0,55.0,16.0,22.0,8.0,12.0,,,,,,,,
East Kent Goldings,GB,7,2,3,4,4,4,2,7,3,8,2,2,2,3,"ESB, Bitter",4.0,6.5,2.0,3.5,0.4,1.0,20.0,35.0,20.0,30.0,8.0,12.0,0.5,1.0,,,,,,
Fuggle,GB,7,2,3,3,5,5,2,7,3,7,2,1,2,2,"Porter, Bitter",3.0,5.5,2.0,3.0,0.7,1.2,20.0,35.0,20.0,30.0,8.0,12.0,,,,,,,,
Challenger,GB,5,3,3,3,4,5,2,6,3,6,3,2,3,2,"ESB, IPA inglesa",6.5,9.5,3.5,4.5,1.0,1.8,25.0,35.0,20.0,30.0,8.0,12.0,,,,,,,,
Target,GB,5,3,3,3,5,6,2,6,3,5,3,2,3,2,"Bitter, IPA",9.0,12.0,3.5,5.0,1.0,1.8,35.0,45.0,15.0,25.0,8.0,12.0,,,,,,,,
Northdown,GB,5,3,3,3,4,6,2,6,3,6,3,2,3,2,"Porter, Bitter",7.0,10.0,3.5,5.5,1.2,1.8,30.0,40.0,18.0,25.0,8.0,12.0,,,,,,,,
Progress,GB,6,3,3,3,4,4,2,6,3,7,3,2,3,2,"Bitter, Mild",5.0,7.0,2.0,3.0,0.8,1.2,25.0,35.0,20.0,30.0,8.0,12.0,,,,,,,,
Admiral,GB,5,4,3,3,4,5,2,5,3,6,3,2,4,2,"Bitter, IPA",13.0,16.0,4.0,6.0,1.0,2.0,35.0,45.0,15.0,25.0,8.0,12.0,,,,,,,,
Saaz,CZ,8,2,3,3,3,5,2,9,4,8,2,1,2,2,"Pilsner, Lager",2.0,6.0,3.0,4.5,0.4,1.0,20.0,35.0,20.0,30.0,8.0,12.0,12.0,18.0,,,,,,
Sladek,CZ,6,5,3,3,3,4,2,6,3,6,4,3,5,3,Pilsner moderna,4.0,8.0,4.0,6.0,0.8,1.6,30.0,40.0,18.0,25.0,8.0,12.0,,,,,,,,
Premiant,CZ,6,4,3,3,3,4,2,6,3,6,3,2,4,3,"Lager, Pilsner",7.0,10.0,4.0,6.0,1.0,1.6,35.0,45.0,18.0,25.0,8.0,12.0,,,,,,,,
Kazbek,CZ,5,6,3,2,3,4,2,5,3,6,5,3,6,4,Lager aromática,5.0,8.0,4.0,6.0,0.9,1.5,35.0,45.0,18.0,25.0,8.0,12.0,,,,,,,,
Nelson Sauvin,NZ,2,7,3,2,3,3,2,4,2,6,8,3,6,5,"IPA, Saison",10.0,13.0,6.0,8.0,0.9,1.2,35.0,40.0,15.0,20.0,8.0,12.0,8.0,12.0,0.6,1.2,0.2,0.6,,
Motueka,NZ,3,8,3,2,2,3,2,5,2,6,7,3,7,6,"Lager lupulada, IPA",6.5,8.5,5.0,5.5,0.8,1.5,45.0,60.0,10.0,15.0,6.0,9.0,10.0,15.0,0.8,2.0,0.8,1.5,,
Riwaka,NZ,2,9,3,2,2,3,2,4,2,5,8,3,7,6,"NEIPA, APA",4.5,6.5,4.0,5.0,0.8,1.2,45.0,60.0,10.0,15.0,6.0,9.0,4.0,8.0,,,,,,
Wai-iti,NZ,2,7,2,2,2,2,1,3,2,6,6,3,7,6,Pale Ale leve,3.0,4.5,3.5,4.5,0.6,1.0,45.0,55.0,10.0,15.0,6.0,9.0,8.0,12.0,,,,,,
Pacifica,NZ,3,6,3,3,3,3,2,6,3,6,5,2,5,4,"Lager, Pilsner",5.0,6.5,6.0,8.0,0.8,1.2,35.0,45.0,15.0,25.0,8.0,12.0,0.0,1.0,,,,,,
Rakau,NZ,3,7,3,2,3,3,2,5,3,6,6,4,7,6,"IPA, APA",10.0,11.0,5.0,7.0,1.5,2.0,45.0,55.0,10.0,15.0,6.0,9.0,3.0,6.0,,,,,,
Pacific Jade,NZ,2,7,4,2,3,6,2,6,3,5,4,3,7,4,"IPA, Pale Ale, Lager, Strong Ale",12.0,14.0,8.0,10.0,1.4,2.0,30.0,40.0,20.0,30.0,8.0,12.0,2.0,4.0,,,,,,
Wakatu,NZ,3,7,4,2,3,2,2,6,3,7,4,2,8,4,"Pale Ale, Lager, Blonde Ale, Golden Ale",6.5,8.5,7.0,8.0,0.8,1.2,30.0,40.0,20.0,30.0,8.0,12.0,12.0,18.0,,,,,,
Galaxy,AU,2,9,3,1,2,3,1,3,2,6,7,6,9,8,"NEIPA, Hazy",13.0,18.5,6.1,11.6,1.9,2.9,32.0,56.0,0.8,2.2,7.0,14.7,2.8,5.1,0.5,1.0,0.1,0.3,,
Vic Secret,AU,2,8,3,2,3,3,2,4,2,5,7,4,8,7,"IPA, APA",14.0,17.0,6.0,7.0,2.0,2.6,50.0,60.0,10.0,15.0,8.0,12.0,,,,,,,,
Ella,AU,3,7,3,2,3,3,2,5,2,6,6,4,7,6,"Saison, Belgian IPA",13.0,16.0,4.0,7.0,1.5,2.4,30.0,40.0,18.0,25.0,8.0,12.0,,,,,,,,
Enigma,AU,2,8,3,2,3,3,2,4,2,6,7,4,8,7,"IPA, NEIPA",15.0,18.0,4.8,6.4,2.4,3.0,35.0,45.0,15.0,20.0,8.0,12.0,,,,,,,,
Eclipse,AU,2,9,3,2,2,3,2,4,2,5,7,4,9,8,"NEIPA, Pale Ale",15.0,19.0,4.5,6.5,2.0,3.0,35.0,45.0,15.0,20.0,8.0,12.0,,,,,,,,
Topaz,AU,3,7,3,2,3,4,2,5,3,6,6,4,7,6,"IPA, Pale Ale",13.0,18.0,5.0,7.0,1.5,2.5,30.0,40.0,18.0,25.0,8.0,12.0,,,,,,,,
Strisselspalt,FR,7,2,3,3,4,4,2,7,3,8,2,1,2,2,"Lager, Belgian Ale",3.0,6.0,2.0,3.5,0.5,0.9,20.0,35.0,20.0,30.0,8.0,12.0,,,,,,,,
Aramis,FR,6,4,3,3,3,5,2,6,3,7,4,3,5,3,Pilsner moderna,6.0,8.0,3.5,4.5,0.7,1.2,20.0,35.0,20.0,30.0,8.0,12.0,,,,,,,,
Barbe Rouge,FR,3,6,3,2,2,3,2,4,2,6,6,7,8,7,IPA frutada,7.0,10.0,3.5,4.5,1.1,1.6,35.0,60.0,15.0,25.0,8.0,12.0,,,,,,,,
Mistral,FR,3,6,3,2,3,3,2,5,2,6,6,4,7,6,"Saison, APA",7.0,9.0,3.0,5.0,1.2,1.8,30.0,40.0,18.0,25.0,8.0,12.0,,,,,,,,
Lúpulo León,ES,6,4,3,3,4,4,2,6,3,7,4,3,4,3,Lager artesanal,5.0,8.0,3.0,5.0,0.8,1.3,,,,,,,,,,,,,,
Mapuche,AR,5,6,3,3,3,4,2,5,3,6,4,3,5,4,"IPA, APA",5.0,7.0,3.0,5.0,0.8,1.5,,,,,,,,,,,,,,
Cascade Patagonia,AR,3,8,4,2,2,3,1,4,3,7,5,2,6,3,"APA, IPA",4.0,9.0,5.5,9.0,0.5,2.0,40.0,60.0,10.0,20.0,4.0,10.0,4.5,8.5,,,,,,
Nugget Patagonia,AR,4,5,4,3,4,6,2,6,3,6,3,2,4,3,"IPA, Stout",11.0,14.0,4.0,6.0,1.5,2.0,45.0,55.0,18.0,25.0,8.0,12.0,,,,,,,,
`;

/* =====================  Utilidades  ===================== */
// Mapa de países para códigos ISO dos flags
const COUNTRY_FLAGS = {
  'US': 'us', 'EUA': 'us',
  'DE': 'de',
  'GB': 'gb',
  'CZ': 'cz',
  'NZ': 'nz',
  'AU': 'au',
  'FR': 'fr',
  'ES': 'es',
  'AR/CH': 'ar', // Argentina para o híbrido AR/CH
  'AR': 'ar',
  'CH': 'cl'
};

function getFlagUrl(countryCode) {
  const isoCode = COUNTRY_FLAGS[countryCode] || countryCode.toLowerCase();
  return `https://flagcdn.com/16x12/${isoCode}.png`;
}

function createFlagElement(countryCode) {
  if (!countryCode) return '';
  const flagUrl = getFlagUrl(countryCode);
  return `<span class="flag" style="background-image:url('${flagUrl}')" title="${countryCode}"></span>`;
}
const ATTRS = ["Chá","Cítrico","Verde","Caramelado","Amadeirado","Picante","Mentolado","Herbal","Vegetal","Floral","Fruta Verde","Fruta Vermelha","Fruta Amarela","Fruta Doce"];

// Mapeamento de ícones para cada característica
const ATTR_ICONS = {
  "Chá": "☕",
  "Cítrico": "🍋", 
  "Verde": "🌿",
  "Caramelado": "🍯",
  "Amadeirado": "🌳",
  "Picante": "🌶️",
  "Mentolado": "❄️",
  "Herbal": "🌱",
  "Vegetal": "🥬",
  "Floral": "🌸",
  "Fruta Verde": "🍏",
  "Fruta Vermelha": "🍓",
  "Fruta Amarela": "🍌",
  "Fruta Doce": "🍑"
};

// Versões com ícones dos atributos
const ATTRS_WITH_ICONS = ATTRS.map(attr => `${ATTR_ICONS[attr]} ${attr}`);
function parseCSV(text){
  // parse simples, suficiente para este CSV (aspas apenas em Estilos)
  const lines = text.trim().split(/\r?\n/);
  const headers = lines.shift().split(",");
  return lines.map(line=>{
    // separa por vírgula, respeitando campo final possivelmente com vírgulas dentro de aspas
    const parts = [];
    let cur = "", inQuotes=false;
    for (let i=0;i<line.length;i++){
      const ch=line[i];
      if(ch === '"' ){ inQuotes = !inQuotes; continue; }
      if(ch === ',' && !inQuotes){ parts.push(cur); cur=""; }
      else cur += ch;
    }
    parts.push(cur);
    const obj = {};
    headers.forEach((h,idx)=> obj[h.trim()] = parts[idx]?.trim() ?? "");
    // números para atributos
    ATTRS.forEach(a=> obj[a] = Number(obj[a]));
    // estilos em array
    obj.Estilos = (obj.Estilos||"").split(",").map(s=>s.trim()).filter(Boolean);
    // normaliza campos nome/país
    obj.nome = obj["Lúpulo"];
    obj.pais = obj["País"];
    return obj;
  });
}
const DATA = parseCSV(csv);

// mapa para lookup rápido
const byName = new Map(DATA.map(d=>[d.nome, d]));

/* =====================  DOM  ===================== */
const leftSel  = document.getElementById('leftSel');
const rightSel = document.getElementById('rightSel');
const qInput   = document.getElementById('q');
const q2Input  = document.getElementById('q2');
const leftMeta = document.getElementById('leftMeta');
const rightMeta= document.getElementById('rightMeta');
const leftPill = document.getElementById('leftPill');
const rightPill = document.getElementById('rightPill');
const leftLegend = document.getElementById('leftLegend');
const rightLegend = document.getElementById('rightLegend');
const leftLegendChem = document.getElementById('leftLegendChem');
const rightLegendChem = document.getElementById('rightLegendChem');
const leftLegendCompounds = document.getElementById('leftLegendCompounds');
const rightLegendCompounds = document.getElementById('rightLegendCompounds');

function formatStyles(arr){ return arr.map(s=>`<span class="tag">${s}</span>`).join(" "); }
function renderMeta(side, hop){
  const t = TRANSLATIONS[currentLang];
  const html = hop ? `
    <div><b>${t.hop_name}</b> ${hop.nome}</div>
    <div><b>${t.hop_country}</b> ${hop.pais}${createFlagElement(hop.pais)}</div>
    <div><b>${t.hop_styles}</b><div class="styles">${formatStyles(hop.Estilos)}</div></div>
  ` : `<div style="color:#7f89b4">${t.select_hop}</div>`;
  (side==='left'?leftMeta:rightMeta).innerHTML = html;
}

let leftOptionsList = [...DATA];
let rightOptionsList = [...DATA];

/* popula selects */
function fillLeftSelect(list){
  const t = TRANSLATIONS[currentLang];
  const opts = list.map(d=>`<option value="${d.nome}">${d.nome} (${d.pais})</option>`).join("");
  leftSel.innerHTML  = `<option value="">${t.select_left}</option>` + opts;
}

function fillRightSelect(list){
  const t = TRANSLATIONS[currentLang];
  const opts = list.map(d=>`<option value="${d.nome}">${d.nome} (${d.pais})</option>`).join("");
  rightSel.innerHTML = `<option value="">${t.select_right}</option>` + opts;
}

function fillSelects(list){
  fillLeftSelect(list);
  fillRightSelect(list);
}

/* filtro de busca esquerdo */
function applyLeftFilter(){
  const q = qInput.value.trim().toLowerCase();
  if(!q){ leftOptionsList = [...DATA]; fillLeftSelect(leftOptionsList); return; }
  leftOptionsList = DATA.filter(d=>{
    const hay = [d.nome, d.pais, ...(d.Estilos||[])].join(" ").toLowerCase();
    return hay.includes(q);
  });
  fillLeftSelect(leftOptionsList);
}

/* filtro de busca direito */
function applyRightFilter(){
  const q = q2Input.value.trim().toLowerCase();
  if(!q){ rightOptionsList = [...DATA]; fillRightSelect(rightOptionsList); return; }
  rightOptionsList = DATA.filter(d=>{
    const hay = [d.nome, d.pais, ...(d.Estilos||[])].join(" ").toLowerCase();
    return hay.includes(q);
  });
  fillRightSelect(rightOptionsList);
}

qInput.addEventListener('input', applyLeftFilter);
q2Input.addEventListener('input', applyRightFilter);

/* =====================  CHART (Radar)  ===================== */
const ctx = document.getElementById('radar').getContext('2d');

const gridColor = getComputedStyle(document.documentElement).getPropertyValue('--ring').trim() || '#2a335a';

const radar = new Chart(ctx, {
  type: 'radar',
  data: {
    labels: ATTRS_WITH_ICONS,
    datasets: [
      {
        label: '',
        data: [], // preenchido ao selecionar
        backgroundColor: 'rgba(76,141,246,0.22)',
        borderColor: 'rgba(76,141,246,1)',
        pointBackgroundColor: 'rgba(76,141,246,1)',
        pointRadius: 3,
        borderWidth: 2,
        order: 1
      },
      {
        label: '',
        data: [],
        backgroundColor: 'rgba(230,91,183,0.22)',
        borderColor: 'rgba(230,91,183,1)',
        pointBackgroundColor: 'rgba(230,91,183,1)',
        pointRadius: 3,
        borderWidth: 2,
        order: 2
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      r: {
        min: 0, max: 10, ticks: { stepSize: 2, showLabelBackdrop:false, color:'#aeb7da' },
        grid: { color: gridColor },
        angleLines: { color: gridColor },
        pointLabels: {
          color: '#dfe6ff',
          font: { size: 11, weight: 500, family: 'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Apple Color Emoji", "Segoe UI Emoji", sans-serif' }
        }
      }
    },
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          title: (ctx)=> ctx[0].label,
          label: (ctx)=> `${ctx.dataset.label}: ${ctx.formattedValue}`
        }
      }
    },
    elements: {
      line: { tension: 0.25 }
    },
    animation: { duration: 350 }
  }
});

/* =====================  CHEMICAL CHART (Bar)  ===================== */
const chemCtx = document.getElementById('chemicalChart').getContext('2d');

const chemicalChart = new Chart(chemCtx, {
  type: 'bar',
  data: {
    labels: ['Ácidos Alfa (%)', 'Ácidos Beta (%)', 'Óleos Essenciais (ml/100g)'],
    datasets: [
      {
        label: '',
        data: [0, 0, 0],
        backgroundColor: 'rgba(76,141,246,0.7)',
        borderColor: 'rgba(76,141,246,1)',
        borderWidth: 2,
        maxBarThickness: 60
      },
      {
        label: '',
        data: [0, 0, 0],
        backgroundColor: 'rgba(230,91,183,0.7)',
        borderColor: 'rgba(230,91,183,1)',
        borderWidth: 2,
        maxBarThickness: 60
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        ticks: { color: '#dfe6ff', font: { size: 11 } },
        grid: { color: gridColor }
      },
      y: {
        ticks: { color: '#aeb7da', font: { size: 11 } },
        grid: { color: gridColor },
        beginAtZero: true
      }
    },
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          title: (ctx) => ctx[0].label,
          label: (ctx) => {
            const unit = ctx.label.includes('ml/100g') ? ' ml/100g' : '%';
            return `${ctx.dataset.label}: ${ctx.formattedValue}${unit}`;
          }
        }
      }
    },
    animation: { duration: 350 }
  }
});

/* =====================  COMPOUNDS CHART (Bar)  ===================== */
const compoundsCtx = document.getElementById('compoundsChart').getContext('2d');

const compoundsChart = new Chart(compoundsCtx, {
  type: 'bar',
  data: {
    labels: ['Mirceno (%)', 'Humuleno (%)', 'Cariofileno (%)', 'Farneseno (%)', 'Linalol (%)', 'Geraniol (%)', 'Polifenóis (%)'],
    datasets: [
      {
        label: '',
        data: [0, 0, 0, 0, 0, 0, 0],
        backgroundColor: 'rgba(76,141,246,0.7)',
        borderColor: 'rgba(76,141,246,1)',
        borderWidth: 2,
        maxBarThickness: 60
      },
      {
        label: '',
        data: [0, 0, 0, 0, 0, 0, 0],
        backgroundColor: 'rgba(230,91,183,0.7)',
        borderColor: 'rgba(230,91,183,1)',
        borderWidth: 2,
        maxBarThickness: 60
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        ticks: { color: '#dfe6ff', font: { size: 11 } },
        grid: { color: gridColor }
      },
      y: {
        ticks: { color: '#aeb7da', font: { size: 11 } },
        grid: { color: gridColor },
        beginAtZero: true
      }
    },
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          title: (ctx) => ctx[0].label,
          label: (ctx) => `${ctx.dataset.label}: ${ctx.formattedValue}%`
        }
      }
    },
    animation: { duration: 350 }
  }
});

/* helpers para extrair vetor de atributos */
function vector(hop){
  return ATTRS.map(a => hop[a] ?? 0);
}

/* helpers para extrair dados químicos */
function getChemicalData(hop) {
  if (!hop) return [0, 0, 0];
  
  const alphaMin = parseFloat(hop['AA_min_%']) || 0;
  const alphaMax = parseFloat(hop['AA_max_%']) || 0;
  const betaMin = parseFloat(hop['BA_min_%']) || 0;
  const betaMax = parseFloat(hop['BA_max_%']) || 0;
  const oilsMin = parseFloat(hop.Oils_min_ml_100g) || 0;
  const oilsMax = parseFloat(hop.Oils_max_ml_100g) || 0;
  
  // Usar a média dos valores min/max
  const alpha = alphaMin && alphaMax ? (alphaMin + alphaMax) / 2 : (alphaMin || alphaMax || 0);
  const beta = betaMin && betaMax ? (betaMin + betaMax) / 2 : (betaMin || betaMax || 0);
  const oils = oilsMin && oilsMax ? (oilsMin + oilsMax) / 2 : (oilsMin || oilsMax || 0);
  
  return [alpha, beta, oils];
}

/* helpers para extrair dados dos compostos */
function getCompoundsData(hop) {
  if (!hop) return [0, 0, 0, 0, 0, 0, 0];
  
  const myrceneMin = parseFloat(hop['Myrcene_min_%']) || 0;
  const myrceneMax = parseFloat(hop['Myrcene_max_%']) || 0;
  const humuleneMin = parseFloat(hop['Humulene_min_%']) || 0;
  const humuleneMax = parseFloat(hop['Humulene_max_%']) || 0;
  const caryophylleneMin = parseFloat(hop['Caryophyllene_min_%']) || 0;
  const caryophylleneMax = parseFloat(hop['Caryophyllene_max_%']) || 0;
  const farneseneMin = parseFloat(hop['Farnesene_min_%']) || 0;
  const farneseneMax = parseFloat(hop['Farnesene_max_%']) || 0;
  const linaloolMin = parseFloat(hop['Linalool_min_%']) || 0;
  const linaloolMax = parseFloat(hop['Linalool_max_%']) || 0;
  const geraniolMin = parseFloat(hop['Geraniol_min_%']) || 0;
  const geraniolMax = parseFloat(hop['Geraniol_max_%']) || 0;
  const polyphenolsMin = parseFloat(hop['Polyphenols_min_%']) || 0;
  const polyphenolsMax = parseFloat(hop['Polyphenols_max_%']) || 0;
  
  // Usar a média dos valores min/max
  const myrcene = myrceneMin && myrceneMax ? (myrceneMin + myrceneMax) / 2 : (myrceneMin || myrceneMax || 0);
  const humulene = humuleneMin && humuleneMax ? (humuleneMin + humuleneMax) / 2 : (humuleneMin || humuleneMax || 0);
  const caryophyllene = caryophylleneMin && caryophylleneMax ? (caryophylleneMin + caryophylleneMax) / 2 : (caryophylleneMin || caryophylleneMax || 0);
  const farnesene = farneseneMin && farneseneMax ? (farneseneMin + farneseneMax) / 2 : (farneseneMin || farneseneMax || 0);
  const linalool = linaloolMin && linaloolMax ? (linaloolMin + linaloolMax) / 2 : (linaloolMin || linaloolMax || 0);
  const geraniol = geraniolMin && geraniolMax ? (geraniolMin + geraniolMax) / 2 : (geraniolMin || geraniolMax || 0);
  const polyphenols = polyphenolsMin && polyphenolsMax ? (polyphenolsMin + polyphenolsMax) / 2 : (polyphenolsMin || polyphenolsMax || 0);
  
  return [myrcene, humulene, caryophyllene, farnesene, linalool, geraniol, polyphenols];
}

/* atualiza gráfico e metadados */
function update(){
  const leftName  = leftSel.value;
  const rightName = rightSel.value;

  const left  = byName.get(leftName);
  const right = byName.get(rightName);

  // Atualizar os dados do gráfico radar
  radar.data.datasets[0].data = left  ? vector(left)  : [];
  radar.data.datasets[1].data = right ? vector(right) : [];

  // Atualizar os labels dos datasets do radar com os nomes dos lúpulos
  radar.data.datasets[0].label = left ? left.nome : '';
  radar.data.datasets[1].label = right ? right.nome : '';

  // Atualizar os dados do gráfico químico
  chemicalChart.data.datasets[0].data = left ? getChemicalData(left) : [0, 0, 0];
  chemicalChart.data.datasets[1].data = right ? getChemicalData(right) : [0, 0, 0];
  
  // Atualizar os labels dos datasets do gráfico químico
  chemicalChart.data.datasets[0].label = left ? left.nome : '';
  chemicalChart.data.datasets[1].label = right ? right.nome : '';

  // Atualizar os dados do gráfico de compostos
  compoundsChart.data.datasets[0].data = left ? getCompoundsData(left) : [0, 0, 0, 0, 0, 0, 0];
  compoundsChart.data.datasets[1].data = right ? getCompoundsData(right) : [0, 0, 0, 0, 0, 0, 0];
  
  // Atualizar os labels dos datasets do gráfico de compostos
  compoundsChart.data.datasets[0].label = left ? left.nome : '';
  compoundsChart.data.datasets[1].label = right ? right.nome : '';

  // Atualizar pills com os nomes dos lúpulos
  const t = TRANSLATIONS[currentLang];
  leftPill.textContent = left ? left.nome : t.left_pill;
  rightPill.textContent = right ? right.nome : t.right_pill;

  // Atualizar legendas do gráfico radar com os nomes dos lúpulos ou texto padrão
  leftLegend.textContent = left ? left.nome : t.legend_left;
  rightLegend.textContent = right ? right.nome : t.legend_right;

  // Atualizar legendas do gráfico químico com os nomes dos lúpulos ou texto padrão
  leftLegendChem.textContent = left ? left.nome : t.legend_left;
  rightLegendChem.textContent = right ? right.nome : t.legend_right;

  // Atualizar legendas do gráfico de compostos com os nomes dos lúpulos ou texto padrão
  leftLegendCompounds.textContent = left ? left.nome : t.legend_left;
  rightLegendCompounds.textContent = right ? right.nome : t.legend_right;

  renderMeta('left', left);
  renderMeta('right', right);

  radar.update();
  chemicalChart.update();
  compoundsChart.update();
}

/* =====================  INTERNACIONALIZAÇÃO - FUNÇÕES  ===================== */
function updateTexts() {
  const t = TRANSLATIONS[currentLang];
  
  // Preserva as seleções atuais
  const currentLeftSelection = leftSel.value;
  const currentRightSelection = rightSel.value;
  
  // Atualiza todos os elementos com data-i18n
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (t[key]) {
      el.innerHTML = t[key];
    }
  });
  
  // Atualiza placeholders
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    const key = el.getAttribute('data-i18n-placeholder');
    if (t[key]) {
      el.placeholder = t[key];
    }
  });
  
  // Recarrega selects e metadados, preservando filtros atuais
  fillLeftSelect(leftOptionsList);
  fillRightSelect(rightOptionsList);
  
  // Restaura as seleções
  leftSel.value = currentLeftSelection;
  rightSel.value = currentRightSelection;
  
  update();
}

function switchLanguage(lang) {
  currentLang = lang;
  localStorage.setItem('hop-radar-lang', lang);
  
  // Atualiza botões ativos
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.lang === lang);
  });
  
  updateTexts();
}

/* =====================  SISTEMA DE ABAS  ===================== */
function switchTab(tabName) {
  // Atualizar botões das abas
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.tab === tabName);
  });
  
  // Atualizar conteúdo das abas
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.toggle('active', content.id === `${tabName}-content`);
  });
}

/* listeners */
leftSel.addEventListener('change', update);
rightSel.addEventListener('change', update);

// Tab switching
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => switchTab(btn.dataset.tab));
});

// Language switching
document.querySelectorAll('.lang-btn').forEach(btn => {
  btn.addEventListener('click', () => switchLanguage(btn.dataset.lang));
});

/* inicialização */
// Aguarda o DOM estar pronto
document.addEventListener('DOMContentLoaded', function() {
  // Configura idioma inicial
  switchLanguage(currentLang);

  /* pré-seleções simpáticas */
  const defaultLeft = byName.has('Cascade') ? 'Cascade' : DATA[0].nome;
  const defaultRight = byName.has('Citra') ? 'Citra' : (DATA[1]?.nome ?? '');
  leftSel.value = defaultLeft;
  rightSel.value = defaultRight;
  update();
});
</script>
</body>
</html>
